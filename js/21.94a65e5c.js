"use strict";(self["webpackChunktoutiao_a"]=self["webpackChunktoutiao_a"]||[]).push([[21],{1021:function(t,e,s){s.r(e),s.d(e,{default:function(){return F}});var n=function(){var t=this,e=t._self._c;return e("div",[e("van-nav-bar",{staticClass:"page-nav-bar",attrs:{title:"搜索"},scopedSlots:t._u([{key:"title",fn:function(){return[e("van-button",{staticClass:"seachbtn",attrs:{to:"/search",type:"info"},scopedSlots:t._u([{key:"icon",fn:function(){return[e("i",{staticClass:"toutiao toutiao-sousuo"})]},proxy:!0},{key:"default",fn:function(){return[t._v(" 搜索 ")]},proxy:!0}])})]},proxy:!0}])}),e("van-tabs",{staticClass:"channels",model:{value:t.active,callback:function(e){t.active=e},expression:"active"}},[t._l(t.userChannels,(function(t){return e("van-tab",{key:t.id,attrs:{title:t.name}},[e("art-list",{attrs:{channelsItem:t}})],1)})),e("div",{staticClass:"hamburgerbtn",on:{click:t.hamburgerFn}},[e("span",{staticClass:"toutiao toutiao-gengduo"})])],2),e("van-popup",{style:{height:"100%"},attrs:{position:"bottom"},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[e("channelEdit",{attrs:{userChannels:t.userChannels,channelActive:t.active},on:{close:function(e){t.show=!1},ischannel:t.ischannel}})],1)],1)},a=[],i=s(2419),r=function(){var t=this,e=t._self._c;return e("div",[e("div",{staticClass:"artlistcon"},[e("van-pull-refresh",{attrs:{"success-text":t.successText},on:{refresh:t.onRefresh},model:{value:t.isLoading,callback:function(e){t.isLoading=e},expression:"isLoading"}},[e("van-list",{attrs:{finished:t.finished,"finished-text":"没有更多了"},on:{load:t.onLoad},model:{value:t.loading,callback:function(e){t.loading=e},expression:"loading"}},t._l(t.list,(function(t){return e("artItem",{key:t.art_id,attrs:{artitem:t}})})),1)],1)],1)])},l=[],c=(s(541),function(){var t=this,e=t._self._c;return e("div",[e("div",{staticClass:"itemone",on:{click:t.goArticle}},[e("div",{staticClass:"itemthree"},[e("div",{staticClass:"title",class:{wd447:1==t.artitem.cover.type}},[t._v(" "+t._s(t.artitem.title)+" ")]),1==t.artitem.cover.type?e("div",{staticClass:"imglist"},t._l(t.artitem.cover.images,(function(t,s){return e("van-image",{key:s,staticClass:"imgitem",attrs:{src:t}})})),1):t._e()]),3==t.artitem.cover.type?e("div",{staticClass:"imglist"},t._l(t.artitem.cover.images,(function(t,s){return e("van-image",{key:s,staticClass:"imgitem",attrs:{src:t}})})),1):t._e(),e("div",{staticClass:"tip"},[e("span",{class:{red:1==t.artitem.is_top}},[t._v(" "+t._s(1==t.artitem.is_top?"置顶":"未置顶")+" ")]),e("span",[t._v(t._s(t.artitem.aut_name))]),e("span",[t._v(t._s(t.artitem.comm_count)+"评论")]),e("span",[t._v(t._s(t._f("datatime")(t.artitem.pubdate)))])])])])}),o=[],u=(s(7658),{props:{artitem:Object},data(){return{}},created(){},methods:{goArticle(){this.$router.push({path:`/article/${this.artitem.art_id}`})}}}),h=u,d=s(1001),m=(0,d.Z)(h,c,o,!1,null,"0a47761f",null),f=m.exports,v={components:{artItem:f},props:{channelsItem:Object},data(){return{list:[],loading:!1,finished:!1,timestamp:(new Date).valueOf(),isLoading:!1,successText:""}},async created(){},methods:{async getArtList(){let t={channel_id:this.channelsItem.id,timestamp:this.timestamp},{data:e}=await(0,i.TF)(t);null==e.data.pre_timestamp||0==e.data.results.length?this.finished=!0:(this.timestamp=e.data.pre_timestamp,this.list=[...this.list,...e.data.results],this.loading=!1)},async onLoad(){this.getArtList()},async onRefresh(){try{let t={channel_id:this.channelsItem.id,timestamp:(new Date).valueOf()},{data:e}=await(0,i.TF)(t);this.list.unshift(...e.data.results),this.successText=`刷新成功，刷新了${e.data.results.length}条数据`,this.isLoading=!1}catch(t){this.isLoading=!1,this.successText="刷新失败",console.log(t)}}}},p=v,g=(0,d.Z)(p,r,l,!1,null,"54dfcee8",null),_=g.exports,C=function(){var t=this,e=t._self._c;return e("div",[e("div",{staticClass:"close",on:{click:function(e){return t.$emit("close")}}},[e("span",{staticClass:"toutiao toutiao-guanbi"})]),e("div",{staticClass:"mycha"},[e("div",[t._v("我的频道")]),e("van-button",{staticClass:"editbtn",attrs:{plain:"",type:"danger",round:""},on:{click:function(e){t.isEdit=!t.isEdit}}},[t._v(" "+t._s(t.isEdit?"完成":"编辑")+" ")])],1),e("van-grid",{attrs:{gutter:10}},t._l(t.userChannels,(function(s,n){return e("van-grid-item",{key:s.id,staticClass:"grid-item",class:{red:t.channelActive==n},attrs:{text:s.name},on:{click:function(e){return t.mychannelFn(n)}},scopedSlots:t._u([t.isEdit&&0!=s.id?{key:"icon",fn:function(){return[e("van-icon",{staticClass:"clearbtn",attrs:{name:"clear"}})]},proxy:!0}:null],null,!0)})})),1),t._m(0),e("van-grid",{attrs:{direction:"horizontal",gutter:10}},t._l(t.recommendChannels,(function(s,n){return e("van-grid-item",{key:n,staticClass:"grid-item",attrs:{text:s.name,icon:"plus"},on:{click:function(e){return t.addchannelFn(s)}}})})),1)],1)},y=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"mycha"},[e("div",[t._v("频道推荐")])])}],b=s(7247),k={props:{userChannels:Array,channelActive:Number},data(){return{allChannel:[],isEdit:!1}},async created(){try{let{data:t}=await(0,i.At)();console.log(t.data.channels),this.allChannel=t.data.channels}catch(t){console.log(t)}},methods:{mychannelFn(t){if(this.isEdit){if(0==this.userChannels[t].id)return!1;t<this.channelActive&&this.$emit("ischannel",this.channelActive-1,!0),this.userChannels.splice(t,1)}else this.$emit("ischannel",t,!1)},addchannelFn(t){this.userChannels.push(t)}},computed:{recommendChannels(){return this.allChannel.filter((t=>!this.userChannels.find((e=>e.id==t.id))))}},watch:{userChannels:{deep:!0,handler(t){if(this.$store.state.token){let e=[];for(let s=0;s<t.length;s++){let n={};n.id=t[s].id,n.seq=s,e.push(n)}(0,i.ti)(e)}else(0,b.LS)("MYCHANNEL",t)}}}},w=k,x=(0,d.Z)(w,C,y,!1,null,"2ccf0143",null),A=x.exports,L={components:{ArtList:_,channelEdit:A},data(){return{userChannels:[],show:!1,active:0}},async created(){try{if(this.$store.state.token){let{data:t}=await(0,i.iH)();this.userChannels=t.data.channels}else{let t=(0,b.rV)("MYCHANNEL");if(t)this.userChannels=t;else{let{data:t}=await(0,i.iH)();this.userChannels=t.data.channels}}}catch(t){console.log(t)}},methods:{hamburgerFn(){this.show=!0},ischannel(t,e){this.show=e,this.active=t}}},E=L,Z=(0,d.Z)(E,n,a,!1,null,"1d5de87e",null),F=Z.exports},5117:function(t,e,s){var n=s(6330),a=TypeError;t.exports=function(t,e){if(!delete t[e])throw a("Cannot delete property "+n(e)+" of "+n(t))}},541:function(t,e,s){var n=s(2109),a=s(7908),i=s(6244),r=s(3658),l=s(5117),c=s(8988),o=1!==[].unshift(0),u=!function(){try{Object.defineProperty([],"length",{writable:!1}).unshift()}catch(t){return t instanceof TypeError}}();n({target:"Array",proto:!0,arity:1,forced:o||u},{unshift:function(t){var e=a(this),s=i(e),n=arguments.length;if(n){c(s+n);var o=s;while(o--){var u=o+n;o in e?e[u]=e[o]:l(e,u)}for(var h=0;h<n;h++)e[h]=arguments[h]}return r(e,s+n)}})},2419:function(t,e,s){s.d(e,{At:function(){return r},TF:function(){return i},iH:function(){return a},iR:function(){return o},sH:function(){return c},ti:function(){return l}});var n=s(5369);const a=()=>(0,n.Z)({url:"/v1_0/user/channels",method:"get"}),i=t=>(0,n.Z)({url:"/v1_0/articles",method:"get",params:t}),r=()=>(0,n.Z)({url:"/v1_0/channels",method:"get"}),l=t=>(0,n.Z)({url:"/v1_0/user/channels",method:"put",data:{channels:t}}),c=t=>(0,n.Z)({url:"/v1_0/suggestion",method:"get",params:{q:t}}),o=t=>(0,n.Z)({url:"/v1_0/search",method:"get",params:t})}}]);
//# sourceMappingURL=21.94a65e5c.js.map