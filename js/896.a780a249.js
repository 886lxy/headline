"use strict";(self["webpackChunktoutiao_a"]=self["webpackChunktoutiao_a"]||[]).push([[896],{2896:function(t,e,o){o.r(e),o.d(e,{default:function(){return mt}});o(7658);var n=function(){var t=this,e=t._self._c;return e("div",{staticClass:"article-container"},[e("van-nav-bar",{staticClass:"page-nav-bar",attrs:{"left-text":"返回","left-arrow":"",title:"黑马头条"},on:{"click-left":function(e){return t.$router.push("/home")}}}),e("div",{staticClass:"main-wrap"},[t.loadingShow?e("div",{staticClass:"loading-wrap"},[e("van-loading",{attrs:{color:"#3296fa",vertical:""}},[t._v("加载中")])],1):t.articleContent.title?e("div",{staticClass:"article-detail"},[e("h1",{staticClass:"article-title"},[t._v(t._s(t.articleContent.title))]),e("van-cell",{staticClass:"user-info",attrs:{center:"",border:!1}},[e("van-image",{staticClass:"avatar",attrs:{slot:"icon",round:"",fit:"cover",src:t.articleContent.aut_photo},slot:"icon"}),e("div",{staticClass:"user-name",attrs:{slot:"title"},slot:"title"},[t._v(" "+t._s(t.articleContent.aut_name)+" ")]),e("div",{staticClass:"publish-date",attrs:{slot:"label"},slot:"label"},[t._v(" "+t._s(t.articleContent.pubdate)+" ")]),e("followCom",{attrs:{autId:t.articleContent.aut_id},model:{value:t.articleContent.is_followed,callback:function(e){t.$set(t.articleContent,"is_followed",e)},expression:"articleContent.is_followed"}})],1),e("div",{ref:"divcontent",staticClass:"article-content markdown-body",domProps:{innerHTML:t._s(t.articleContent.content)}}),e("van-divider",[t._v("正文结束")]),e("commentList",{attrs:{artId:t.articleContent.art_id,newCommentObj:t.newCommentObj,type:"a"},on:{totalCountFn:function(e){t.totalCount=e},openReplyCom:t.openReplyCom}})],1):t.statusShow?e("div",{staticClass:"error-wrap"},[e("van-icon",{attrs:{name:"failure"}}),e("p",{staticClass:"text"},[t._v("该资源不存在或已删除！")])],1):e("div",{staticClass:"error-wrap"},[e("van-icon",{attrs:{name:"failure"}}),e("p",{staticClass:"text"},[t._v("内容加载失败！")]),e("van-button",{staticClass:"retry-btn",on:{click:t.retryFn}},[t._v("点击重试")])],1)]),e("div",{staticClass:"article-bottom"},[e("van-button",{staticClass:"comment-btn",attrs:{type:"default",round:"",size:"small"},on:{click:t.addCommentFn}},[t._v(" 写评论 ")]),e("van-icon",{attrs:{name:"comment-o",info:t.totalCount,color:"#777"}}),e("collectedCom",{attrs:{artId:t.articleContent.art_id},model:{value:t.articleContent.is_collected,callback:function(e){t.$set(t.articleContent,"is_collected",e)},expression:"articleContent.is_collected"}}),e("likeingCom",{attrs:{artId:t.articleContent.art_id},model:{value:t.articleContent.attitude,callback:function(e){t.$set(t.articleContent,"attitude",e)},expression:"articleContent.attitude"}}),e("van-icon",{attrs:{name:"share",color:"#777777"}})],1),e("van-popup",{attrs:{position:"bottom"},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[e("commentPost",{attrs:{artId:t.articleContent.art_id},on:{newCommentObjFn:t.newCommentObjFn,closepopup:function(e){t.show=!1}}})],1),e("van-popup",{staticStyle:{height:"100%"},attrs:{position:"bottom"},model:{value:t.replyComShow,callback:function(e){t.replyComShow=e},expression:"replyComShow"}},[t.replyComShow?e("commentReply",{attrs:{topCommentItem:t.topCommentItem},on:{closepopup:function(e){t.replyComShow=!1}}}):t._e()],1)],1)},s=[],i=o(5369);const a=t=>(0,i.Z)({url:`/v1_0/articles/${t}`,method:"get"}),l=t=>(0,i.Z)({url:"/v1_0/user/followings",method:"post",data:{target:t}}),c=t=>(0,i.Z)({url:`/v1_0/user/followings/${t}`,method:"delete"}),r=t=>(0,i.Z)({url:"/v1_0/article/collections",method:"post",data:{target:t}}),m=t=>(0,i.Z)({url:`/v1_0/article/collections/${t}`,method:"delete"}),d=t=>(0,i.Z)({url:"/v1_0/article/likings",method:"post",data:{target:t}}),u=t=>(0,i.Z)({url:`/v1_0/article/likings/${t}`,method:"delete"});var p=o(993),h=function(){var t=this,e=t._self._c;return e("div",[t.isFollowed?e("van-button",{staticClass:"follow-btn",attrs:{round:"",size:"small",loading:t.following},on:{click:t.followFn}},[t._v("已关注")]):e("van-button",{staticClass:"follow-btn",attrs:{loading:t.following,type:"info",color:"#3296fa",round:"",size:"small",icon:"plus"},on:{click:t.followFn}},[t._v("关注")])],1)},C=[],v={model:{prop:"isFollowed",event:"isFollowFn"},props:{autId:{type:[Number,String]},isFollowed:Boolean},data(){return{following:!1}},methods:{async followFn(){this.following=!0;try{this.isFollowed?await c(this.autId):await l(this.autId),this.following=!1,this.$emit("isFollowFn",!this.isFollowed)}catch(t){console.log(t)}}}},f=v,w=o(1001),_=(0,w.Z)(f,h,C,!1,null,"37191e81",null),g=_.exports,b=function(){var t=this,e=t._self._c;return e("div",[e("van-button",{staticClass:"starbtn",attrs:{icon:t.isCollected?"star":"star-o",type:"primary",loading:t.collecting},on:{click:t.collectFn}})],1)},y=[],k={model:{prop:"isCollected",event:"isCollectedFn"},props:{isCollected:Boolean,artId:{type:[Number,String]}},data(){return{collecting:!1}},methods:{async collectFn(){try{this.collecting=!0,this.isCollected?(await m(this.artId),this.$toast.success("取消收藏")):(await r(this.artId),this.$toast.success("收藏成功")),this.collecting=!1,this.$emit("isCollectedFn",!this.isCollected)}catch(t){console.log(t)}}}},I=k,F=(0,w.Z)(I,b,y,!1,null,"51d1326e",null),S=F.exports,$=function(){var t=this,e=t._self._c;return e("div",[e("van-button",{staticClass:"starbtn",attrs:{icon:1==t.isLike?"good-job":"good-job-o",type:"primary",loading:t.likeLoading},on:{click:t.likeFn}})],1)},x=[],L={model:{prop:"isLike",event:"isLikeFn"},props:{isLike:[Number,String],artId:[Number,String]},data(){return{likeLoading:!1}},methods:{async likeFn(){try{this.likeLoading=!0;let t=this.artId;1!=this.isLike?(await d(t),this.$emit("isLikeFn",1),this.$toast.success("点赞成功")):(await u(t),this.$emit("isLikeFn",-1),this.$toast.success("取消点赞")),this.likeLoading=!1}catch(t){console.log(t)}}}},j=L,O=(0,w.Z)(j,$,x,!1,null,"4592d0e5",null),Z=O.exports,P=function(){var t=this,e=t._self._c;return e("div",[e("div",{staticClass:"comment-post"},[e("van-field",{staticClass:"postcomment",attrs:{rows:"2",autosize:"",type:"textarea",maxlength:"50",placeholder:"请输入留言","show-word-limit":""},model:{value:t.message,callback:function(e){t.message=e},expression:"message"}}),e("van-button",{staticClass:"postbtn",on:{click:t.postcomment}},[t._v("发布")])],1)])},R=[];const N=t=>(0,i.Z)({url:"/v1_0/comments",method:"get",params:t}),z=t=>(0,i.Z)({url:"/v1_0/comment/likings",method:"post",data:{target:t}}),A=t=>(0,i.Z)({url:`/v1_0/comment/likings/${t}`,method:"delete"}),T=t=>(0,i.Z)({url:"/v1_0/comments",method:"post",data:t});var E={props:{artId:{type:[Number,String]}},data(){return{message:""}},methods:{async postcomment(){if(0!=this.message.trim())try{let t={target:this.artId,content:this.message,art_id:this.$store.state.articleId},{data:e}=await T(t);this.message="",this.$emit("newCommentObjFn",e.data.new_obj),this.$emit("closepopup")}catch(t){console.log(t)}else this.$toast("请填写内容！！")}}},q=E,B=(0,w.Z)(q,P,R,!1,null,"cda493ae",null),H=B.exports,M=function(){var t=this,e=t._self._c;return e("div",[e("van-nav-bar",{attrs:{title:t.topCommentItem.reply_count>0?`${t.topCommentItem.reply_count}条回复`:"赞无评论","left-arrow":""},scopedSlots:t._u([{key:"left",fn:function(){return[e("van-icon",{attrs:{name:"cross"},on:{click:function(e){return t.$emit("closepopup")}}})]},proxy:!0}])}),e("commentItem",{attrs:{comItem:t.topCommentItem}}),e("van-cell",{attrs:{title:"全部回复"}}),e("commentList",{attrs:{type:"c",artId:t.topCommentItem.com_id,newCommentObj:t.newCommentObj}}),e("div",{staticClass:"reply-bottom"},[e("van-button",{staticClass:"write-btn",attrs:{size:"small",round:""},on:{click:function(e){t.addPeplyCommentShow=!0}}},[t._v("写评论")])],1),e("van-popup",{attrs:{position:"bottom"},model:{value:t.addPeplyCommentShow,callback:function(e){t.addPeplyCommentShow=e},expression:"addPeplyCommentShow"}},[e("commentPost",{attrs:{artId:t.topCommentItem.com_id},on:{newCommentObjFn:t.newCommentObjFn}})],1)],1)},D=[],G=function(){var t=this,e=t._self._c;return e("div",[e("van-cell",{staticClass:"comment-item"},[e("van-image",{staticClass:"avatar",attrs:{slot:"icon",round:"",fit:"cover",src:t.comItem.aut_photo},slot:"icon"}),e("div",{staticClass:"title-wrap",attrs:{slot:"title"},slot:"title"},[e("div",{staticClass:"user-name"},[t._v(t._s(t.comItem.aut_name))]),e("van-button",{staticClass:"like-btn",class:{likeing:t.comItem.is_liking},attrs:{icon:"good-job"},on:{click:t.likeFn}},[t._v(" "+t._s(t.comItem.like_count||"赞")+" ")])],1),e("div",{attrs:{slot:"label"},slot:"label"},[e("p",{staticClass:"comment-content"},[t._v(t._s(t.comItem.content))]),e("div",{staticClass:"bottom-info"},[e("span",{staticClass:"comment-pubdate"},[t._v(t._s(t._f("datatime")(t.comItem.pubdate)))]),e("van-button",{staticClass:"reply-btn",attrs:{round:""},on:{click:t.replyComFn}},[t._v(" 回复 "+t._s(t.comItem.reply_count)+" ")])],1)])],1)],1)},J=[],K={props:{comItem:Object},name:"CommentItem",components:{},data(){return{}},methods:{async likeFn(){try{this.comItem.is_liking?(await A(this.comItem.com_id),this.comItem.like_count--):(await z(this.comItem.com_id),this.comItem.like_count++),this.comItem.is_liking=!this.comItem.is_liking}catch(t){console.log(t)}},replyComFn(){this.$emit("openReplyCom",this.comItem)}}},Q=K,U=(0,w.Z)(Q,G,J,!1,null,"78fb3fc2",null),V=U.exports,W=function(){var t=this,e=t._self._c;return e("div",[e("van-list",{attrs:{finished:t.finished,"finished-text":"没有更多了","immediate-check":!1},on:{load:t.onLoad},model:{value:t.loading,callback:function(e){t.loading=e},expression:"loading"}},t._l(t.commentList,(function(o){return e("commentItem",{key:o.com_id,attrs:{comItem:o},on:{openReplyCom:t.openReplyCom}})})),1)],1)},X=[],Y=(o(541),{props:{type:String,artId:{type:[Number,String]},newCommentObj:Object},components:{commentItem:V},data(){return{commentList:[],loading:!1,finished:!1,offset:""}},created(){this.onLoad()},methods:{async onLoad(){try{let t={type:this.type,source:this.artId,offset:this.offset,limit:10},{data:e}=await N(t);0==e.data.results.length?this.finished=!0:(this.offset=e.data.last_id,this.commentList=[...this.commentList,...e.data.results],this.loading=!1,this.$emit("totalCountFn",e.data.total_count))}catch(t){console.log(t)}},openReplyCom(t){this.$emit("openReplyCom",t)}},watch:{newCommentObj:{deep:!0,handler(t){let e=this.commentList.find((e=>e.com_id==t.com_id));e||this.commentList.unshift(t)}}}}),tt=Y,et=(0,w.Z)(tt,W,X,!1,null,"ae702f36",null),ot=et.exports,nt={props:{topCommentItem:Object},components:{commentItem:V,commentList:ot,commentPost:H},data(){return{addPeplyCommentShow:!1,newCommentObj:{}}},methods:{newCommentObjFn(t){this.addPeplyCommentShow=!1,this.newCommentObj=t,this.topCommentItem.reply_count++}}},st=nt,it=(0,w.Z)(st,M,D,!1,null,"ae6142a4",null),at=it.exports,lt={name:"ArticleIndex",components:{followCom:g,collectedCom:S,likeingCom:Z,commentList:ot,commentPost:H,commentReply:at},props:{articleId:{type:[Number,String],required:!0}},data(){return{loadingShow:!1,articleContent:{},statusShow:!1,following:!1,totalCount:0,show:!1,newCommentObj:{},replyComShow:!1,topCommentItem:{}}},created(){this.$store.commit("setArticleId",this.articleId),this.retryFn()},methods:{async retryFn(){try{this.loadingShow=!0;let{data:t}=await a(this.articleId);this.articleContent=t.data,this.$nextTick((()=>{let t=this.$refs.divcontent,e=t.querySelectorAll("img"),o=[];e.forEach(((t,e)=>{o.push(t.src),t.onclick=function(){(0,p.Z)({images:o,startPosition:e})}})),console.log(e)})),this.loadingShow=!1}catch(t){this.loadingShow=!1,404==t.response.status&&(this.statusShow=!0),console.log(t)}},isLikeFn(t){this.articleContent.attitude=t},addCommentFn(){this.show=!0},newCommentObjFn(t){this.newCommentObj=t},openReplyCom(t){this.replyComShow=!0,this.topCommentItem=t}}},ct=lt,rt=(0,w.Z)(ct,n,s,!1,null,"48247234",null),mt=rt.exports},5117:function(t,e,o){var n=o(6330),s=TypeError;t.exports=function(t,e){if(!delete t[e])throw s("Cannot delete property "+n(e)+" of "+n(t))}},541:function(t,e,o){var n=o(2109),s=o(7908),i=o(6244),a=o(3658),l=o(5117),c=o(8988),r=1!==[].unshift(0),m=!function(){try{Object.defineProperty([],"length",{writable:!1}).unshift()}catch(t){return t instanceof TypeError}}();n({target:"Array",proto:!0,arity:1,forced:r||m},{unshift:function(t){var e=s(this),o=i(e),n=arguments.length;if(n){c(o+n);var r=o;while(r--){var m=r+n;r in e?e[m]=e[r]:l(e,m)}for(var d=0;d<n;d++)e[d]=arguments[d]}return a(e,o+n)}})}}]);
//# sourceMappingURL=896.a780a249.js.map